<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mmking.course.mapper.TeachPlanMapper">

    <resultMap id="treeMap" type="TeachplanNode">
        <id property="id" column="t1Id"></id>
        <result property="pname" column="t1Pname"></result>
        <collection property="children" ofType="TeachplanNode">
            <id property="id" column="t2Id"></id>
            <result property="pname" column="t2Pname"></result>
            <collection property="children" ofType="TeachplanNode">
                <id property="id" column="t3Id"></id>
                <result property="pname" column="t3Pname"></result>
            </collection>
        </collection>
    </resultMap>


    <select id="selectListByCourseId" parameterType="String" resultMap="treeMap">


        SELECT t1.id t1Id, t1.pname t1Pname, t2.id t2Id, t2.pname t2Pname, t3.id t3Id, t3.pname t3Pname
        FROM teachplan t1
                 left join teachplan t2 on t2.parentid = t1.id
                 left join teachplan t3 on t3.parentid = t2.id
        where t1.parentid = 0
          <if test=" _parameter !=null and _parameter != ''"></if>
          and t1.courseid = #{course}
        order by t1.pname, t2.pname, t3.pname


    </select>
</mapper>